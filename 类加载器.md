> æœ¬æ–‡ç”± [ç®€æ‚¦ SimpRead](http://ksria.com/simpread/) è½¬ç ï¼Œ åŸæ–‡åœ°å€ https://zhuanlan.zhihu.com/p/54693308 Japan Adult Video Actor

## **é¢è¯•å®˜ï¼šè¯·è¯´è¯´ä½ ç†è§£çš„ç±»åŠ è½½å™¨ã€‚**

* * *

æˆ‘ï¼šé€šè¿‡ä¸€ä¸ªç±»çš„å…¨é™å®šåæ¥è·å–æè¿°æ­¤ç±»çš„äºŒè¿›åˆ¶å­—èŠ‚æµè¿™ä¸ªåŠ¨ä½œæ”¾åˆ° Java è™šæ‹Ÿæœºå¤–éƒ¨å»å®ç°ï¼Œä»¥ä¾¿è®©åº”ç”¨ç¨‹åºè‡ªå·±å†³å®šå¦‚ä½•å»è·å–æ‰€éœ€è¦çš„ç±»ã€‚å®ç°è¿™ä¸ªåŠ¨ä½œçš„ä»£ç æ¨¡å—ç§°ä¸º **â€œç±»åŠ è½½å™¨â€**ã€‚

## **é¢è¯•å®˜ï¼šè¯´è¯´æœ‰å“ªå‡ ç§ç±»åŠ è½½å™¨ï¼Œä»–ä»¬çš„èŒè´£åˆ†åˆ«æ˜¯ä»€ä¹ˆï¼Œä»–ä»¬ä¹‹å‰å­˜åœ¨ä»€ä¹ˆæ ·çš„çº¦å®šã€‚**

* * *

æˆ‘ï¼šemmmmï¼Œæˆ‘åœ¨çº¸ä¸Šè¾¹ç”»è¾¹è®²å§ã€‚

ç±»åŠ è½½çš„ç»“æ„å¦‚ä¸‹ï¼š

![](https://pic2.zhimg.com/v2-9e3254602608f3d224ac1dd3ab816075_b.jpg)![](https://pic2.zhimg.com/v2-9e3254602608f3d224ac1dd3ab816075_r.jpg)

*   **BootstrapClassLoader**ï¼šå¯åŠ¨ç±»ç±»åŠ è½½å™¨ï¼Œå®ƒç”¨æ¥åŠ è½½ <JAVA_HOME>/jre/lib è·¯å¾„,**-**Xbootclasspath å‚æ•°æŒ‡å®šçš„è·¯å¾„ä»¥ <JAVA_HOME>/jre/classes ä¸­çš„ç±»ã€‚BootStrapClassLoader æ˜¯ç”± c++ å®ç°çš„ã€‚
*   **ExtClassLoader**ï¼šæ‹“å±•ç±»ç±»åŠ è½½å™¨ï¼Œå®ƒç”¨æ¥åŠ è½½ <JAVA_HOME>/jre/lib/ext è·¯å¾„ä»¥åŠ java.ext.dirs ç³»ç»Ÿå˜é‡æŒ‡å®šçš„ç±»è·¯å¾„ä¸‹çš„ç±»ã€‚
*   **AppClassLoader**ï¼šåº”ç”¨ç¨‹åºç±»ç±»åŠ è½½å™¨ï¼Œå®ƒä¸»è¦åŠ è½½åº”ç”¨ç¨‹åº ClassPath ä¸‹çš„ç±»ï¼ˆåŒ…å« jar åŒ…ä¸­çš„ç±»ï¼‰ã€‚å®ƒæ˜¯ java åº”ç”¨ç¨‹åºé»˜è®¤çš„ç±»åŠ è½½å™¨ã€‚
*   **ç”¨æˆ·è‡ªå®šä¹‰ç±»åŠ è½½å™¨**ï¼šç”¨æˆ·æ ¹æ®è‡ªå®šä¹‰éœ€æ±‚ï¼Œè‡ªç”±çš„å®šåˆ¶åŠ è½½çš„é€»è¾‘ï¼Œç»§æ‰¿ AppClassLoaderï¼Œä»…ä»…è¦†ç›– findClassï¼ˆï¼‰å³å°†ç»§ç»­éµå®ˆåŒäº²å§”æ´¾æ¨¡å‹ã€‚
*   ***ThreadContextClassLoader**ï¼šçº¿ç¨‹ä¸Šä¸‹æ–‡åŠ è½½å™¨ï¼Œå®ƒä¸æ˜¯ä¸€ä¸ªæ–°çš„ç±»å‹ï¼Œæ›´åƒä¸€ä¸ªç±»åŠ è½½å™¨çš„è§’è‰²ï¼ŒThreadContextClassLoader å¯ä»¥æ˜¯ä¸Šè¿°ç±»åŠ è½½å™¨çš„ä»»æ„ä¸€ç§ï¼Œä½†å¾€å¾€æ˜¯ AppClassLoaderï¼Œä½œç”¨æˆ‘ä»¬åé¢å†è¯´ã€‚

åœ¨è™šæ‹Ÿæœºå¯åŠ¨çš„æ—¶å€™ä¼šåˆå§‹åŒ– BootstrapClassLoaderï¼Œç„¶ååœ¨ Launcher ç±»ä¸­å»åŠ è½½ ExtClassLoaderã€AppClassLoaderï¼Œå¹¶å°† AppClassLoader çš„ parent è®¾ç½®ä¸º ExtClassLoaderï¼Œå¹¶è®¾ç½®çº¿ç¨‹ä¸Šä¸‹æ–‡ç±»åŠ è½½å™¨ã€‚

**Launcher** æ˜¯ JRE ä¸­ç”¨äºå¯åŠ¨ç¨‹åºå…¥å£ main() çš„ç±»ï¼Œè®©æˆ‘ä»¬çœ‹ä¸‹ Launcher çš„ä»£ç 

```
public Launcher() {
        Launcher.ExtClassLoader var1;
        try {
            //åŠ è½½æ‰©å±•ç±»ç±»åŠ è½½å™¨
            var1 = Launcher.ExtClassLoader.getExtClassLoader();
        } catch (IOException var10) {
            throw new InternalError("Could not create extension class loader", var10);
        }

        try {
            //åŠ è½½åº”ç”¨ç¨‹åºç±»åŠ è½½å™¨ï¼Œå¹¶è®¾ç½®parentä¸ºextClassLoader
            this.loader = Launcher.AppClassLoader.getAppClassLoader(var1);
        } catch (IOException var9) {
            throw new InternalError("Could not create application class loader", var9);
        }
        //è®¾ç½®é»˜è®¤çš„çº¿ç¨‹ä¸Šä¸‹æ–‡ç±»åŠ è½½å™¨ä¸ºAppClassLoader
        Thread.currentThread().setContextClassLoader(this.loader);
        //æ­¤å¤„åˆ é™¤æ— å…³ä»£ç ã€‚ã€‚ã€‚
        }

```

ä¸Šé¢ç”»çš„å‡ ç§ç±»åŠ è½½å™¨æ˜¯éµå¾ª**åŒäº²å§”æ´¾æ¨¡å‹**çš„ï¼Œå…¶å®å°±æ˜¯ï¼Œå½“ä¸€ä¸ªç±»åŠ è½½å™¨å»åŠ è½½ç±»æ—¶å…ˆå°è¯•è®©çˆ¶ç±»åŠ è½½å™¨å»åŠ è½½ï¼Œå¦‚æœçˆ¶ç±»åŠ è½½å™¨åŠ è½½ä¸äº†å†å°è¯•è‡ªèº«åŠ è½½ã€‚è¿™ä¹Ÿæ˜¯æˆ‘ä»¬åœ¨è‡ªå®šä¹‰ ClassLoader æ—¶ java å®˜æ–¹å»ºè®®éµå®ˆçš„çº¦å®šã€‚

## **é¢è¯•å®˜æ’å˜´ï¼š**ExtClassLoader ä¸ºä»€ä¹ˆæ²¡æœ‰è®¾ç½® parentï¼Ÿ

æˆ‘ï¼šåˆ«æ€¥å•Šï¼Œæˆ‘è¿˜æ²¡è¯´å®Œã€‚

è®©æˆ‘ä»¬çœ‹çœ‹ä¸‹é¢ä»£ç çš„è¾“å‡ºç»“æœ

```
 public static void main(String[] args) throws ClassNotFoundException {
        ClassLoader classLoader = Test.class.getClassLoader();
        System.out.println(classLoader);
        System.out.println(classLoader.getParent());
        System.out.println(classLoader.getParent().getParent());
    }

```

çœ‹çœ‹ç»“æœæ˜¯å•¥

```
sun.misc.Launcher$AppClassLoader@18b4aac2
sun.misc.Launcher$ExtClassLoader@5a61f5df
null

```

å› ä¸º BootstrapClassLoader æ˜¯ç”± c++ å®ç°çš„ï¼Œæ‰€ä»¥å¹¶ä¸å­˜åœ¨ä¸€ä¸ª Java çš„ç±»ï¼Œå› æ­¤ä¼šæ‰“å°å‡º nullï¼Œæ‰€ä»¥åœ¨ ClassLoader ä¸­ï¼Œnull å°±ä»£è¡¨äº† BootStrapClassLoaderï¼ˆæœ‰äº›ç‰‡é¢ï¼‰ã€‚

é‚£ä¹ˆåŒäº²å§”æ´¾çš„å¥½å¤„æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿ

åŒäº²å§”æ´¾æ¨¡å‹èƒ½ä¿è¯åŸºç¡€ç±»ä»…åŠ è½½ä¸€æ¬¡ï¼Œä¸ä¼šè®© jvm ä¸­å­˜åœ¨é‡åçš„ç±»ã€‚æ¯”å¦‚ String.classï¼Œæ¯æ¬¡åŠ è½½éƒ½å§”æ‰˜ç»™çˆ¶åŠ è½½å™¨ï¼Œæœ€ç»ˆéƒ½æ˜¯ BootstrapClassLoaderï¼Œéƒ½ä¿è¯ java æ ¸å¿ƒç±»éƒ½æ˜¯ BootstrapClassLoader åŠ è½½çš„ï¼Œä¿è¯äº† java çš„å®‰å…¨ä¸ç¨³å®šæ€§ã€‚

## **é¢è¯•å®˜ï¼šé‚£è‡ªå·±æ€ä¹ˆå»å®ç°ä¸€ä¸ª ClassLoader å‘¢ï¼Ÿè¯·ä¸¾ä¸ªå®é™…çš„ä¾‹å­ã€‚**

* * *

æˆ‘ï¼šå¥½çš„ï¼ˆè„¸ä¸Šç¬‘å˜»å˜»ï¼Œå¿ƒé‡Œ mmpï¼‰ã€‚

è‡ªå·±å®ç° ClassLoader æ—¶åªéœ€è¦ç»§æ‰¿ ClassLoader ç±»ï¼Œç„¶åè¦†ç›– findClassï¼ˆString nameï¼‰æ–¹æ³•å³å¯å®Œæˆä¸€ä¸ªå¸¦æœ‰åŒäº²å§”æ´¾æ¨¡å‹çš„ç±»åŠ è½½å™¨ã€‚

æˆ‘ä»¬çœ‹ä¸‹ ClassLoader#loadClass çš„ä»£ç 

```
protected Class<?> loadClass(String name, boolean resolve)
        throws ClassNotFoundException
    {
        synchronized (getClassLoadingLock(name)) {
            // æŸ¥çœ‹æ˜¯å¦å·²ç»åŠ è½½è¿‡è¯¥ç±»ï¼ŒåŠ è½½è¿‡çš„ç±»ä¼šæœ‰ç¼“å­˜ï¼Œæ˜¯ä½¿ç”¨nativeæ–¹æ³•å®ç°çš„
            Class<?> c = findLoadedClass(name);
            if (c == null) {
                long t0 = System.nanoTime();
                try {
                    //çˆ¶ç±»ä¸ä¸ºç©ºåˆ™å…ˆè®©çˆ¶ç±»åŠ è½½
                    if (parent != null) {
                        c = parent.loadClass(name, false);
                    } else {
                    //çˆ¶ç±»æ˜¯nullå°±æ˜¯BootstrapClassLoaderï¼Œä½¿ç”¨å¯åŠ¨ç±»ç±»åŠ è½½å™¨åŠ è½½
                        c = findBootstrapClassOrNull(name);
                    }
                } catch (ClassNotFoundException e) {
                    // çˆ¶ç±»ç±»åŠ è½½å™¨ä¸èƒ½åŠ è½½è¯¥ç±»
                }

                //å¦‚æœçˆ¶ç±»æœªåŠ è½½è¯¥ç±»
                if (c == null) {
                    // If still not found, then invoke findClass in order
                    // to find the class.
                    long t1 = System.nanoTime();
                    //è®©å½“å‰ç±»åŠ è½½å™¨åŠ è½½
                    c = findClass(name);
                }
            }
            return c;
        }
    }

```

ç»å…¸çš„æ¨¡æ¿æ–¹æ³•æ¨¡å¼ï¼Œå­ç±»åªéœ€è¦å®ç° findClassï¼Œå…³å¿ƒä»å“ªé‡ŒåŠ è½½å³å¯ã€‚

è¿˜æœ‰ä¸€ç‚¹ï¼Œparent éœ€è¦è‡ªå·±è®¾ç½®å“¦ï¼Œå¯ä»¥æ”¾åœ¨æ„é€ å‡½æ•°åšè¿™ä¸ªäº‹æƒ…ã€‚

## **é¢è¯•å®˜æ’å˜´ï¼š**ä¸ºä»€ä¹ˆä¸ç»§æ‰¿ AppClassLoader å‘¢ï¼Ÿ

æˆ‘ï¼šå› ä¸ºå®ƒå’Œ ExtClassLoader éƒ½æ˜¯ Launcher çš„é™æ€ç±»ï¼Œéƒ½æ˜¯åŒ…è®¿é—®è·¯å¾„æƒé™çš„ã€‚

## **é¢è¯•å®˜**ï¼šgoodï¼Œä½ ç»§ç»­ã€‚

æˆ‘ï¼šemmmmmï¼Œé‚£æˆ‘ä¸¾ä¸ªå®é™…çš„ğŸŒ°

ä»£ç çƒ­æ›¿æ¢ï¼Œåœ¨ä¸é‡å¯æœåŠ¡å™¨çš„æƒ…å†µä¸‹å¯ä»¥ä¿®æ”¹ç±»çš„ä»£ç å¹¶ä½¿ä¹‹ç”Ÿæ•ˆã€‚

1.  é¦–å…ˆæ˜¯è‡ªå®šä¹‰ä¸€ä¸ª ClassLoader

```
public class MyClassLoader extends ClassLoader {
    //ç”¨äºè¯»å–.Classæ–‡ä»¶çš„è·¯å¾„
    private String swapPath;
    //ç”¨äºæ ‡è®°è¿™äº›nameçš„ç±»æ˜¯å…ˆç”±è‡ªèº«åŠ è½½çš„
    private Set<String> useMyClassLoaderLoad;

    public MyClassLoader(String swapPath, Set<String> useMyClassLoaderLoad) {
        this.swapPath = swapPath;
        this.useMyClassLoaderLoad = useMyClassLoaderLoad;
    }

    @Override
    public Class<?> loadClass(String name) throws ClassNotFoundException {
        Class<?> c = findLoadedClass(name);
        if (c == null && useMyClassLoaderLoad.contains(name)){
            //ç‰¹æ®Šçš„ç±»è®©æˆ‘è‡ªå·±åŠ è½½
            c = findClass(name);
            if (c != null){
                return c;
            }
        }
        return super.loadClass(name);
    }

    @Override
    protected Class<?> findClass(String name) {
        //æ ¹æ®æ–‡ä»¶ç³»ç»Ÿè·¯å¾„åŠ è½½classæ–‡ä»¶ï¼Œå¹¶è¿”å›byteæ•°ç»„
        byte[] classBytes = getClassByte(name);
        //è°ƒç”¨ClassLoaderæä¾›çš„æ–¹æ³•ï¼Œå°†äºŒè¿›åˆ¶æ•°ç»„è½¬æ¢æˆClassç±»çš„å®ä¾‹
        return defineClass(name, classBytes, 0, classBytes.length);
    }

    private byte[] getClassByte(String name) {
        String className = name.substring(name.lastIndexOf('.') + 1, name.length()) + ".class";
        try {
            FileInputStream fileInputStream = new FileInputStream(swapPath + className);
            byte[] buffer = new byte[1024];
            int length = 0;
            ByteArrayOutputStream byteArrayOutputStream = new ByteArrayOutputStream();
            while ((length = fileInputStream.read(buffer)) > 0){
                byteArrayOutputStream.write(buffer, 0, length);
            }
            return byteArrayOutputStream.toByteArray();
        } catch (IOException e) {
            e.printStackTrace();
        }
        return new byte[]{};
    }
}

```

2\. è‡ªå®šä¹‰ä¸€ä¸ªç¤ºä¾‹ç±»ï¼Œç”¨äºè¢«æˆ‘ä»¬è‡ªå·±çš„ç±»åŠ è½½å™¨åŠ è½½

```
public class Test {
    public void printVersion(){
        System.out.println("å½“å‰ç‰ˆæœ¬æ˜¯1å“¦");
    }
}

```

3\. å†™ä¸ªå®šæ—¶ä»»åŠ¡ï¼Œä¸€ç›´è°ƒç”¨ printVersion æ–¹æ³•ï¼Œè§‚å¯Ÿè¾“å‡ºï¼Œçœ‹æˆ‘ä»¬æ˜¯å¦æ›¿æ¢æˆåŠŸã€‚

```
 public static void main(String[] args) {
        //åˆ›å»ºä¸€ä¸ª2sæ‰§è¡Œä¸€æ¬¡çš„å®šæ—¶ä»»åŠ¡
        new Timer().schedule(new TimerTask() {
            @Override
            public void run() {
                String swapPath = MyClassLoader.class.getResource("").getPath() + "swap/";
                String className = "com.example.Test";

                //æ¯æ¬¡éƒ½å®ä¾‹åŒ–ä¸€ä¸ªClassLoaderï¼Œè¿™é‡Œä¼ å…¥swapè·¯å¾„ï¼Œå’Œéœ€è¦ç‰¹æ®ŠåŠ è½½çš„ç±»å
                MyClassLoader myClassLoader = new MyClassLoader(swapPath, Sets.newHashSet(className));
                try {
                    //ä½¿ç”¨è‡ªå®šä¹‰çš„ClassLoaderåŠ è½½ç±»ï¼Œå¹¶è°ƒç”¨printVersionæ–¹æ³•ã€‚
                    Object o = myClassLoader.loadClass(className).newInstance();
                    o.getClass().getMethod("printVersion").invoke(o);
                } catch (InstantiationException |
                        IllegalAccessException |
                        ClassNotFoundException |
                        NoSuchMethodException |
                        InvocationTargetException ignored) {
                }
            }
        }, 0,2000);
    }

```

æ“ä½œæ­¥éª¤ï¼š

1.  å…ˆç¼–è¯‘ä¸‹å·¥ç¨‹ï¼Œå°† Test.class æ‹·è´åˆ° swap æ–‡ä»¶å¤¹ä¸‹ã€‚
2.  è¿è¡Œ main æ–¹æ³•ï¼Œå¯è§‚å¯Ÿåˆ°æ§åˆ¶å°ä¸€ç›´è¾“å‡º â€œå½“å‰ç‰ˆæœ¬æ˜¯ 1 å“¦â€ã€‚
3.  ä¿®æ”¹ Test#pringtVersion æ–¹æ³•çš„æºä»£ç ï¼Œå°†è¾“å‡ºçš„å†…å®¹æ”¹ä¸º "å½“å‰ç‰ˆæœ¬æ˜¯ 2 å“¦"ï¼Œç„¶åç¼–è¯‘å·¥ç¨‹ï¼Œå°†æ–°çš„ Test.class æ‹·è´åˆ° swap æ–‡ä»¶ä»¶ä¸‹ï¼Œå¹¶æ›¿æ¢ä¹‹å‰çš„ Test.classã€‚

è¾“å‡ºç»“æœå¦‚å›¾æ‰€ç¤ºã€‚

![](https://pic1.zhimg.com/v2-9df2672f99eb1f8f2813f97763f387dc_b.jpg)![](https://pic1.zhimg.com/80/v2-9df2672f99eb1f8f2813f97763f387dc_hd.jpg)

å¯ä»¥çœ‹åˆ°ï¼Œæˆ‘ä»¬å†æ²¡æœ‰é‡å¯çš„æƒ…å†µä¸‹ï¼Œå®Œæˆäº†ç±»çš„çƒ­æ›¿æ¢ã€‚

ï¼ˆæˆªå›¾ä¸æ˜¯å¾ˆå®Œæ•´ï¼Œè¦ç›¸ä¿¡æˆ‘ï¼Œæˆ‘æ˜¯æ‘¸ç€è‰¯å¿ƒçš„æ“ä½œçš„ï¼Œç»å¯¹ä¸æ˜¯å¤§çŒªè¹„å­ï¼‰

## **é¢è¯•å®˜æ’å˜´ï¼š**ä¸ºä»€ä¹ˆéœ€è¦ o.getClass().getMethod("printVersion").invoke(o); è¿™æ ·é€šè¿‡åå°„è·å– method è°ƒç”¨ï¼Œä¸èƒ½å…ˆå¼ºè½¬æˆ Testï¼Œç„¶å test.printVersion() å—ï¼Ÿ

æˆ‘ï¼šå› ä¸ºå¦‚æœä½ è¿™ä¹ˆå†™

```
Test test = (Test)o;
o.printVersion();

```

Test.class ä¼šéšæ€§çš„è¢«åŠ è½½å½“å‰ç±»çš„ ClassLoader åŠ è½½ï¼Œå½“å‰ Main æ–¹æ³•é»˜è®¤çš„ ClassLoader ä¸º AppClassLoaderï¼Œè€Œä¸æ˜¯æˆ‘ä»¬è‡ªå®šä¹‰çš„ MyClassLoaderã€‚

## **é¢è¯•å®˜æ’å˜´ï¼šé‚£ä¼šå‘ç”Ÿä»€ä¹ˆå‘¢ï¼Ÿ**

æˆ‘ï¼šä¼šæŠ›å‡º ClassCastExceptionï¼Œå› ä¸ºä¸€ä¸ªç±»ï¼Œå°±ç®—åŒ…è·¯å¾„å®Œå…¨ä¸€è‡´ï¼Œä½†æ˜¯åŠ è½½ä»–ä»¬çš„ ClassLoader ä¸ä¸€æ ·ï¼Œé‚£ä¹ˆè¿™ä¸¤ä¸ªç±»ä¹Ÿä¼šè¢«è®¤ä¸ºæ˜¯ä¸¤ä¸ªä¸åŒçš„ç±»ã€‚

## **é¢è¯•å®˜ï¼šå—¯ï¼Œå…¶å®ä½ åˆšæ‰å†™çš„ ClassLoader å·²ç»ç ´åäº†åŒäº²å§”æ´¾æ¨¡å‹çš„çº¦å®šï¼Œä½ ä¸æ˜¯è¯´è¿™æ˜¯ java å®˜æ–¹æ¨èçš„çº¦å®šå—ï¼Ÿ**

* * *

æˆ‘ï¼šjava æ˜æ˜è‡ªå·±ä¹Ÿæ‚„æ‚„çš„ç ´åäº†è¿™ä¸ªåŒäº²å§”æ´¾æ¨¡å‹ã€‚

ä¸¾ä¸ª jdbc çš„ä¾‹å­ã€‚

```
Class.forName("com.mysql.jdbc.Driver");

```

è¿™å¥è¯åœ¨ jdk1.6 ä¹‹å‰ï¼ˆå‡†ç¡®çš„è¯´æ˜¯ jdbc4.0 ä¹‹å‰ï¼‰æ˜¯è°ƒç”¨æ–¹å¿…é¡»è¦å†™çš„ï¼Œå¦åˆ™ä¼šæ‰¾ä¸åˆ°æ•°æ®åº“é©±åŠ¨ã€‚

é‚£åœ¨ jdk1.6 ä¹‹åæ˜¯æ€ä¹ˆåšåˆ°è‡ªåŠ¨åŠ è½½é©±åŠ¨çš„å‘¢ï¼Ÿæ ¸å¿ƒåœ¨ä¸ java.sql.DriverManagerã€‚

```
//æˆ‘ä»¬æ—¥å¸¸è°ƒç”¨åªéœ€è¦è¿™æ ·æ—¢å¯è·å–è¿æ¥ï¼ŒåŒ…å«äº†è‡ªåŠ¨æ‰«æé©±åŠ¨
Connection connection = DriverManager.getConnection("jdbc://localhost:3306");

```

DriverManager æœ‰è¿™ä¹ˆä¸€æ®µä»£ç 

```
static {
        loadInitialDrivers();
        println("JDBC DriverManager initialized");
    }

private static void loadInitialDrivers() {
        String drivers; 
        AccessController.doPrivileged(new PrivilegedAction<Void>() {
            public Void run() {
                //é‡ç‚¹ï¼Œåœ¨classPathä¸‹åŠ è½½Driverçš„å®ç°ç±»
                ServiceLoader<Driver> loadedDrivers = ServiceLoader.load(Driver.class);
                Iterator<Driver> driversIterator = loadedDrivers.iterator();
                try{
                    while(driversIterator.hasNext()) {
                        //è®¿é—®ä¸€ä¸‹ä»€ä¹ˆéƒ½ä¸åšï¼Œå…¶å®å°±æ˜¯åŠ è½½è¯¥ç±»
                        driversIterator.next();
                    }
                } catch(Throwable t) {
                // Do nothing
                }
                return null;
            }
        });
        println("DriverManager.initialize: jdbc.drivers = " + drivers);
    }

```

æˆ‘ç²¾ç®€äº†ä»£ç ï¼Œåªç•™ä¸‹äº†æœ€å…³é”®çš„éƒ¨åˆ†ï¼Œå½“ DriverManager è¢«åŠ è½½æ—¶ï¼Œé™æ€ä»£ç å—æ‰§è¡Œ loadInitialDrivers æ–¹æ³•ï¼Œå°±æ˜¯åŠ è½½åˆå§‹é©±åŠ¨ã€‚

java.util.ServiceLoader.load(Class) å¯ä»¥æŸ¥è¯¢ classPath ä¸‹ï¼Œæ‰€æœ‰ META-INF ä¸‹ç»™å®š Class åçš„æ–‡ä»¶ï¼Œå¹¶å°†å…¶å†…å®¹è¿”å›ï¼Œä½¿ç”¨è¿­ä»£å™¨éå†ï¼Œè¿™é‡Œéå†çš„å†…éƒ¨å…¶å®å°±æ˜¯ä½¿ç”¨ Class.forName åŠ è½½äº†è¯¥ç±»ã€‚

```
public static <S> ServiceLoader<S> load(Class<S> service) {
        //é‡ç‚¹é‡ç‚¹ï¼ï¼ï¼
        ClassLoader cl = Thread.currentThread().getContextClassLoader();
        return ServiceLoader.load(service, cl);
    }

 public static <S> ServiceLoader<S> load(Class<S> service,
                                            ClassLoader loader)
    {
        return new ServiceLoader<>(service, loader);
    }

```

ç›´æ¥çœ‹ä¸‹ **ServiceLoader** ä¸­è¿”å›çš„è¿­ä»£å™¨çš„ **next**() æ–¹æ³•ï¼Œå…¶å®æœ€ç»ˆè°ƒç”¨çš„æ˜¯ **nextService()** æ–¹æ³•

```
public S next() {
            if (acc == null) {
                return nextService();
            } else {
                PrivilegedAction<S> action = new PrivilegedAction<S>() {
                    public S run() { return nextService(); }
                };
                return AccessController.doPrivileged(action, acc);
            }
        }

private S nextService() {
            if (!hasNextService())
                throw new NoSuchElementException();
            Class<?> c = null;
            try {
                //ä½¿ç”¨å½“å‰ç¤ºä¾‹çš„æˆå‘˜å˜é‡loaderåŠ è½½ï¼Œå°±æ˜¯ä¸Šé¢è®¾ç½®çš„ThreadContextClassLoader
                c = Class.forName(cn, false, loader);
            } catch (ClassNotFoundException x) {
                fail(service,
                     "Provider " + cn + " not found");
            }

        }

```

è¿™æ ·å°±å®Œæˆäº†åœ¨ BootstrapClassLoader åŠ è½½çš„ç±»ï¼ˆå°±æ˜¯åŒ…å java å¼€å¤´çš„ç±»ï¼‰ä¸­é€šè¿‡ ThreadContextClassLoader åŠ è½½äº†åº”ç”¨ç¨‹åºçš„å®ç°ç±»ã€‚

## **é¢è¯•å®˜æ’å˜´ï¼šç­‰ç­‰ï¼ŒserviceLoader æ€ä¹ˆåŠ è½½çš„å®ç°ç±»ï¼Ÿä½ æ²¡æå•Šã€‚**

æˆ‘ï¼šå¿˜äº†è¯´ **hasNextService()** æ–¹æ³•äº†,

```
private boolean hasNextService() {
            if (nextName != null) {
                return true;
            }
            if (configs == null) {
                try {
                    //é‡ç‚¹  å‰ç¼€ + è¦æŸ¥æ‰¾çš„ç±»çš„å…¨é™å®šå 
                    String fullName = PREFIX + service.getName();
                    if (loader == null)
                        configs = ClassLoader.getSystemResources(fullName);
                    else
                        //ä½¿ç”¨ClassLoaderçš„getResourceæ–¹æ³•æŸ¥è¯¢èµ„æº
                        configs = loader.getResources(fullName);
                } catch (IOException x) {
                    fail(service, "Error locating configuration files", x);
                }
            }
            while ((pending == null) || !pending.hasNext()) {
                if (!configs.hasMoreElements()) {
                    return false;
                }
                pending = parse(service, configs.nextElement());
            }
            nextName = pending.next();
            return true;
        }

```

è¯´åˆ°åº•ï¼ŒåŠ è½½ç±»ã€åŠ è½½èµ„æºè¿˜æ˜¯å¾—é  ClassLoaderã€‚

PREFIX çš„å®šä¹‰

```
private static final String PREFIX = "META-INF/services/";

```

å’¦ï¼Œè¿™ä¸ªå€¼æ˜¯ä¸æ˜¯å¾ˆç†Ÿæ‚‰ï¼Œå…¶å®è¿™å°±æ˜¯ java SPI æœºåˆ¶ä¸­çš„ PREFIXï¼ŒSPI å…ˆä¸å±•å¼€ã€‚

emmmmï¼Œ

ServiceLoader.load çš„åŸç†å°±æ˜¯å» classPath ä¸‹å¯»æ‰¾ PREFIX + className çš„æ–‡ä»¶ï¼Œå¹¶è¯»å–å…¶å†…å®¹ä½œä¸ºå®ç°ç±»çš„å…¨é™å®šåè¿”å›ï¼Œä¾æ‰˜çš„æ˜¯ classLoader çš„ **getResources** ç³»åˆ—æ–¹æ³•ã€‚

åœ¨è¿™é‡Œå°±æ˜¯å» classPath ä¸‹å¯»æ‰¾ META-INF/services/java.sql.Driver çš„æ–‡ä»¶ã€‚

å¥½ï¼Œé‚£æˆ‘ä»¬çœ‹çœ‹ mysql æ€ä¹ˆåšçš„ã€‚

![](https://pic3.zhimg.com/v2-7049822f616228e98bbe71b152487c3a_b.jpg)![](https://pic3.zhimg.com/80/v2-7049822f616228e98bbe71b152487c3a_hd.jpg)![](https://pic3.zhimg.com/v2-1c032c853e6753864313834e186dd83a_b.jpg)![](https://pic3.zhimg.com/80/v2-1c032c853e6753864313834e186dd83a_hd.jpg)

å’Œæè¿°å¦‚å‡ºä¸€è¾™ï¼Œå¯ä»¥å¡«å†™å¤šä¸ªå®ç°ç±»ï¼Œä¹Ÿè¡¨ç¤º DriverManager æ˜¯æ”¯æŒå¤šä¸ªé©±åŠ¨çš„ã€‚

ï¼ˆMySQL Fabric æ˜¯ oracle2014 å¹´æ¨å‡ºçš„è‡ªåŠ¨åˆ†ç‰‡ã€è‡ªåŠ¨é€‰ä¸»çš„ä¸œä¸œï¼Œä¸åœ¨è¿™é‡Œå±•å¼€ï¼‰

è‡³æ­¤ DriverManager é€šè¿‡ ThreadContextClassLoaderâ€œä½œå¼Šâ€ çš„äº‹æƒ…å°±è®²å®Œäº†ã€‚

## **é¢è¯•å®˜ï¼šä½ åˆšæ‰æåˆ°çš„ SPI æœºåˆ¶ï¼Œå¯ä»¥è¯´è¯´å®ƒå—ï¼Ÿä½ çŸ¥é“æœ‰å“ªäº›å¸¸ç”¨çš„æ¡†æ¶ä½¿ç”¨åˆ°äº†å®ƒå—ï¼Ÿ**

* * *

æˆ‘ï¼šSPI(Service Provider Interface) æœåŠ¡æä¾›æ¥å£ã€‚å®ƒæ˜¯ jdk å†…ç½®çš„ä¸€ç§æœåŠ¡å‘ç°æœºåˆ¶ï¼ˆä¸æ˜¯å¾®æœåŠ¡é‡Œçš„æœåŠ¡å‘ç°å“¦ï¼‰ï¼Œå®ƒå¯ä»¥è®©æœåŠ¡å®šä¹‰ä¸å®ç°åˆ†ç¦»ã€è§£è€¦ï¼Œå¤§å¤§æå‡äº†ç¨‹åºçš„æ‰©å±•æ€§ã€‚

SPI åŠ è½½çš„æ ¸å¿ƒå°±æ˜¯ ClassLoader çš„ getResource ç³»åˆ—æ–¹æ³•ï¼Œjdk æä¾›äº†ä¸€ä¸ªå·¥å…·ç±»ï¼Œå°±æ˜¯ä¸Šé¢è¯´çš„ **ServiceLoader**ã€‚

è¿˜æœ‰åƒæ¯”å¦‚ Spring ä¸­å°±å®ç°äº†è‡ªå·±çš„ SPI æœºåˆ¶, ä¸¾ä¸ªæœ€å…¸å‹çš„ä¾‹å­ï¼Œ

SpringBoot Starter çš„åŸç†å°±æ˜¯ä¾æ‰˜ Spring çš„ **SpringFactoriesLoader**

SpringFactoriesLoader æ˜¯ä¸€ä¸ª Spring æ ¹æ®è‡ªå·±çš„éœ€æ±‚å®ç°çš„ä¸ ServiceLoader åŠŸèƒ½ç›¸ä»¿çš„å·¥å…·ç±»ï¼Œç”¨äºä»¥ SPI çš„æ–¹å¼åŠ è½½åº”ç”¨ç¨‹åºçš„æ‰©å±•ç±»ã€‚

çœ‹ä¸‹æ ¸å¿ƒæ–¹æ³•æ„Ÿå—ä¸€ä¸‹

```
private static Map<String, List<String>> loadSpringFactories(@Nullable ClassLoader classLoader) {
        //å¼„ä¸ªç¼“å­˜ï¼Œä»¥å…æ¯æ¬¡éƒ½é‡æ–°å¯»æ‰¾ï¼Œè¿™å¯æ˜¯æŸ¥è¯¢æ•´ä¸ªclassPathä¸‹çš„æ‰€æœ‰jaråŒ…å‘¢
        MultiValueMap<String, String> result = (MultiValueMap)cache.get(classLoader);
        if (result != null) {
            return result;
        } else {
            try {
                //springå®šä¹‰çš„PREFIXä¸ºMETF-INF/spring.factories,æŸ¥æ‰¾æ‰€æœ‰è¯¥æ–‡ä»¶å¹¶è¯»å–å†…å®¹
                Enumeration<URL> urls = classLoader != null ? classLoader.getResources("META-INF/spring.factories") : ClassLoader.getSystemResources("META-INF/spring.factories");
                LinkedMultiValueMap result = new LinkedMultiValueMap();

                //åŒ…è£…æˆä¸€ä¸ªmapè¿”å›
                while(urls.hasMoreElements()) {
                    URL url = (URL)urls.nextElement();
                    UrlResource resource = new UrlResource(url);
                    Properties properties = PropertiesLoaderUtils.loadProperties(resource);
                    Iterator var6 = properties.entrySet().iterator();

                    while(var6.hasNext()) {
                        Entry<?, ?> entry = (Entry)var6.next();
                        List<String> factoryClassNames = Arrays.asList(StringUtils.commaDelimitedListToStringArray((String)entry.getValue()));
                        result.addAll((String)entry.getKey(), factoryClassNames);
                    }
                }

                //æ”¾å…¥ç¼“å­˜
                cache.put(classLoader, result);
                return result;
            } catch (IOException var9) {
                throw new IllegalArgumentException("Unable to load factories from location [META-INF/spring.factories]", var9);
            }
        }
    }

```

springboot è‡ªåŠ¨é…ç½®çš„åŸå› æ˜¯å› ä¸ºä½¿ç”¨äº† @EnableAutoConfiguration æ³¨è§£ã€‚

å½“ç¨‹åºåŒ…å«äº† EnableAutoConfiguration æ³¨è§£ï¼Œé‚£ä¹ˆå°±ä¼šæ‰§è¡Œä¸‹é¢çš„æ–¹æ³•ï¼Œç„¶åä¼šåŠ è½½æ‰€æœ‰ spring.factories æ–‡ä»¶ï¼Œå°†å…¶å†…å®¹å°è£…æˆä¸€ä¸ª mapï¼Œspring.factories å…¶å®å°±æ˜¯ä¸€ä¸ªåå­—ç‰¹æ®Šçš„ properties æ–‡ä»¶ã€‚

åœ¨ spring-boot åº”ç”¨å¯åŠ¨æ—¶ï¼Œä¼šè°ƒç”¨ **loadFactoryNames** æ–¹æ³•ï¼Œå…¶ä¸­ä¼ é€’çš„ FactoryClass å°±æ˜¯ **EnableAutoConfiguration**ã€‚

```
public static List<String> loadFactoryNames(Class<?> factoryClass, @Nullable ClassLoader classLoader) {
        // æ­¤ä¾‹å°±æ˜¯:org.springframework.boot.autoconfigure.EnableAutoConfiguration
        String factoryClassName = factoryClass.getName();
        return (List)loadSpringFactories(classLoader).getOrDefault(factoryClassName, Collections.emptyList());
    }

protected Class<?> getSpringFactoriesLoaderFactoryClass() {
		return EnableAutoConfiguration.class;
	}

```

è¿™é‡Œå¯èƒ½æè¿°çš„ä¸æ¸…æ¥šï¼Œé‚£æˆ‘ä»¬ç¨å¾®çœ‹ä¸‹ mybatis-spring-boot-starter

![](https://pic2.zhimg.com/v2-dfa0bea133c7f0189f6589eb4f4d36b5_b.jpg)![](https://pic2.zhimg.com/80/v2-dfa0bea133c7f0189f6589eb4f4d36b5_hd.jpg)![](https://pic1.zhimg.com/v2-a8c74b47ef651ac35f0cf0a64a96a790_b.jpg)![](https://pic1.zhimg.com/80/v2-a8c74b47ef651ac35f0cf0a64a96a790_hd.jpg)

çœŸç›¸å¤§ç™½ï¼ï¼ï¼

æˆ‘å¯ä»¥ä¼‘æ¯ä¼šå„¿äº†å§ã€‚

## **é¢è¯•å®˜ï¼šå—¯ï¼Œäº†è§£çš„è¿˜æ˜¯è›®å…¨é¢çš„ã€‚ä¸è¿‡åŸæœ¬æœŸå¾…å¬åˆ°çš„ä¾‹å­æ˜¯ OSGIã€‚**

* * *

**æˆ‘ï¼šå“¦ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚**

## **é¢è¯•å®˜ï¼šé‚£æˆ‘ä»¬æ¢ä¸ªè¯é¢˜ï¼Œä¸Šé¢ä½ æåˆ° Springï¼Œé‚£æˆ‘ä»¬èŠä¸€èŠ Spring å§ã€‚**

æˆ‘ï¼šèƒ½ä¸èƒ½è®©æˆ‘æ­‡ä¼šå„¿ã€‚ã€‚ã€‚

## **é¢è¯•å®˜ï¼šè¿™æ ·å•Šï¼Œé‚£ä»Šå¤©çš„é¢è¯•åˆ°æ­¤ç»“æŸï¼Œä½ å›å»æ­‡ç€ç­‰é€šçŸ¥å§ã€‚**

**æˆ‘ï¼š*!&(*$*!**@@ï¿¥**ï¼ˆï¼**ï¼‰ï¼ˆ***%#ï¿¥@ã€‚

**yy äº†ä¸€æ®µå…³äºç±»åŠ è½½å™¨çš„é¢è¯•è¿‡ç¨‹ï¼Œæ ¹æ®é—®é¢˜çš„ä¸æ–­æ·±å…¥ï¼Œè¾ƒç³»ç»Ÿçš„å›é¡¾äº†ä¸‹ç±»åŠ è½½å™¨çš„ç›¸å…³çŸ¥è¯†åŠåº”ç”¨ã€‚**

**çŸ¥ä¹å¤„å¥³ä½œï¼Œå¸Œæœ›å¤§ä½¬ä»¬çƒ­æƒ…çš„è½»å–·ã€‚**

**ä½œè€…èƒ½åŠ›æœ‰é™ï¼Œå¦‚æœ‰ä¸æ­£ï¼Œåˆ«å® æººæˆ‘ã€‚**

å†™ä¸‹ä½ çš„è¯„è®º...

è€å®è¯´ï¼Œé¢è¯•ä»æœªé‡åˆ°è¿‡é—®ç±»åŠ è½½å™¨çš„ï¼Œä¸€èˆ¬é—®ç±»åŠ è½½çš„è¿‡ç¨‹

æ˜¯çš„ï¼Œä½†æ˜¯é—®ç±»åŠ è½½å¾ˆå¯èƒ½å°±ä¼šé—®åˆ°ï¼Œå¾ˆå¯èƒ½å°±ä¼šä¸€ç›´æ·±æŒ–

æ„Ÿè§‰ java ç™½å†™è¿™ä¹ˆå¤šå¹´äº†

å“ˆå“ˆï¼Œè¯»æ·±å…¥ç†è§£ java è™šæ‹Ÿæœºæœ‰æ„Ÿ

æœç„¶çœ‹è¿™ç¯‡æ–‡ç« ä¹‹å‰å¾—å¥½å¥½è¯»ä¸€è¯»æ·±å…¥ç†è§£ java è™šæ‹Ÿæœº

ç„¶åæ ¡éªŒä¸‹æˆ‘æœ‰æ²¡æœ‰å†™é”™çš„åœ°æ–¹
æƒ³æŠŠ Java è™šæ‹Ÿæœºçœ‹æ‡‚ï¼Œæœ€å¥½å…ˆå­¦ä¹ æ±‡ç¼–è¯­è¨€
é¢è¯•é—®è¿™ä¸ªï¼Œå½“åœºèƒ½å›ç­”ä¸Šæ¥çš„ï¼Œä¸æ˜¯ä¸“é—¨èƒŒäº†é¢è¯•é¢˜çš„æ°´è´§ï¼Œå°±æ˜¯ç²¾ä¸“åš Java åº•å±‚æ¡†æ¶å·¥å…·å¼€å‘ 10 å¹´ + çš„ï¼Œè·Ÿå¤§éƒ¨åˆ†åº”ç”¨å‹ä¼ä¸šçš„éœ€æ±‚æ ¹æœ¬ä¸æ­å˜ï¼Œä¸çŸ¥é“æœ‰ä»€ä¹ˆæ„ä¹‰ã€‚
æˆ‘å‡ å¹´å‰ä»”ç»†è¯»è¿‡ ClassLoaderï¼Œä¸ç”¨æ—©å¿˜å…‰äº†ã€‚
emmmï¼Œå…¶å®ä¸æ˜¯çš„ã€‚ä¼ä¸šçš„éœ€æ±‚ä¸€èˆ¬è€è¯´ç”¨ä¸ä¸Šï¼Œä½†ä¹Ÿä¸æ’é™¤åƒ jrebel å°†çƒ­æ›¿æ¢åšåˆ°æè‡´ç„¶ååˆ©ç”¨å…¶ç›ˆåˆ©çš„ä¼ä¸šã€‚ä½†æ˜¯ä½ è‚¯å®šé‡åˆ°è¿‡ classNotFindExceptionï¼Œåœ¨æ’æŸ¥é—®é¢˜çš„æ—¶å€™äº†è§£åŸç†æ‰èƒ½å¯¹ç—‡ä¸‹è¯ã€‚è¿˜æœ‰æˆç†Ÿçš„ä¸­é—´ä»¶ï¼Œæ¯”å¦‚ tomcatï¼Œspringï¼Œdubbo å…¶å®åº•å±‚éƒ½æ˜¯å¯¹ classLoader åšè¿‡ç›¸åº”çš„å¤„ç†ã€‚emmmmï¼Œæ€»ç»“ä¸‹æ¥è¯´ï¼Œç†è§£åº•å±‚åŸç†æ‰èƒ½æ›´å¥½çš„æ¬ç –
çœ‹äº†ä½ çš„æ–‡ç« ï¼Œå›å¿†èµ·ä¹‹å‰ç”¨ duboo çš„æ—¶å€™çš„ç»å†äº†ï¼Œemmm
æ©ï¼Œè¯´çš„å¾ˆæ·±å…¥ã€‚è™½ç„¶å¹³æ—¶å·¥ä½œä¸­ä¸€èˆ¬æƒ…å†µç”¨ä¸åˆ°ï¼Œä½†æ˜¯äº†è§£ä¸€ä¸‹ä¹Ÿæ˜¯å¥½çš„ã€‚
å—¯å—¯å—¯ï¼Œæœ‰æ”¶è·å°±å¥½
æœ‰ç‚¹ä¸æ˜ç™½ï¼Œå‰é¢ä»‹ç»ç”¨æˆ·è‡ªå®šä¹‰ç±»åŠ è½½å™¨çš„æ—¶å€™è¯´ç»§æ‰¿ AppClassLoaderï¼Œåé¢ä¸¾çš„ä¾‹å­æ˜¯ç›´æ¥ç»§æ‰¿ ClassLoaderï¼Œè¿™é‡Œçš„åŒºåˆ«æ˜¯ä»€ä¹ˆï¼Œæœ›è§£ç­”ï¼Œè°¢è°¢ã€‚
ä¹‹å‰çš„å›¾å¯èƒ½æœ‰è¯¯å¯¼ï¼ŒåŒäº²å§”æ´¾ä¸é ç»§æ‰¿æ¥å®ç°ï¼Œè€Œæ˜¯é€šè¿‡ç»„åˆçš„æ–¹å¼ï¼Œå³æœ‰ä¸ªæˆå‘˜å˜é‡ parent å­˜çˆ¶ç±»åŠ è½½å™¨ã€‚è¿˜æœ‰æ–‡ç« é‡Œè¯´åˆ° AppClassLoader æ˜¯ä¸èƒ½ç»§æ‰¿çš„ï¼Œå› ä¸ºå®ƒæ˜¯ Launcher çš„å†…éƒ¨ç±»ä¸”ä¸æ˜¯ public çš„ã€‚æ‰€ä»¥æˆ‘ä»¬ä¸€èˆ¬è‡ªå®šä¹‰ç±»åŠ è½½å™¨éƒ½æ˜¯ç»§æ‰¿ ClassLoader æˆ–è€… URLClassLoader

è€é“ è®²ä¸€ä¸‹ spring å§

![](https://pic2.zhimg.com/v2-90359a720808ff45062287127cfa1039_r.gif)
æˆ‘å†æ•´ç†æ•´ç†å“ˆ
è¿™æ ·é—®æˆ‘å¯èƒ½ä¼šæ‰“æ­»ä»–
åŠå¹´ç»éªŒä¼šé—®è¿™äº›ä¹ˆ çœ‹çš„ä¸ç®—éå¸¸æ˜ç™½ç”šè‡³çœ‹ä¸ä¸‹å»
è¿™ä¸æ˜¯çœŸå®é¢è¯•åœºæ™¯ï¼Œåªæ˜¯è‡ªå·± yy çš„åœºæ™¯ï¼Œè®©è‡ªå·±å¸¦ç€é—®é¢˜å»æ€è€ƒã€‚
æˆ‘ä¸æ˜¯å¾ˆæ˜ç™½å¯¹äºä¸€å¹´åŠå¹´ç»éªŒçš„å¼€å‘é¢è¯•éš¾åº¦ä¼šåœ¨å“ªæ–¹é¢ å› ä¸ºåœ¨éƒ‘å·å¾ˆå¤šé—®æ¡†æ¶å’Œå‰ç«¯çŸ¥è¯†è‡³å°‘ jsh5 å’Œ css jq è¦ä¼šè¿‡åˆ†çš„æ‹›ä¸ªåç«¯è¿˜è¦ä¼š vue ä½†æ˜¯æˆ‘è§‰å¾—åƒåç«¯ java åŸºç¡€è¿™äº› jvm jmm å¥½åƒæ¯”è¾ƒé‡è¦ ç„¶åä¹Ÿä¸çŸ¥é“è¿˜æœ‰ä»€ä¹ˆäº† å¤šçº¿ç¨‹ io å’Œç®—æ³•
å¸Œæœ›å‡ºç‚¹ spring çš„ä¸œè¥¿çœ‹çœ‹ï¼Œè¿™äº›å¯¹å°ç™½æ¥è¯´å¤ªéš¾äº†
emmmmï¼Œæ˜¯æœ‰ç‚¹ä¸å‹å¥½ã€‚ä¸ä¼šå¤šçœ‹å‡ éç†è§£ä¸‹ï¼Œå¯ä»¥çš„ã€‚Spring çš„åç»­ä¼šå‡ºçš„
å¾ˆå‰å®³å•Šå°ä¼™å­
ä½ ç¡®å®šå±å¹•å¯¹é¢ä¸æ˜¯æŠ è„šä¸­å¹´å¤§å”ï¼Ÿ
è¿™ä¸æ˜¯æˆ‘å­¦çš„ java, æˆ‘ä¸æƒ³å­¦è¿™æ ·çš„ java[æƒŠè®¶][æƒŠè®¶][æƒŠè®¶]
æ‹¿å‡ºç¬”çš„é‚£ä¸€åˆ»ï¼Œç›´å¥”è¯„è®º
è¿˜æ˜¯è›®å¥½çš„
åªçœ‹æ‡‚ä¸€åŠ

è™½ç„¶æˆ‘çœ‹ä¸æ‡‚ ä½†æˆ‘è§‰å¾—å¥½ï¼(ç ´éŸ³) é¡ºä¾¿å‚¬æ›´ä¸€ä¸‹å¤§ä½¬çš„ Spring

![](https://pic1.zhimg.com/v2-12562ad40366818a1ea39bcecb2599a0_r.gif)
å†™çš„å¾ˆè¯¦ç»†è¿˜æœ‰å®ä¾‹ä»£ç  [èµ]
ç„¶åå°±æ²¡æœ‰ç„¶åäº†â€¦â€¦
æ‘¸ç€è‰¯å¿ƒæƒ³æƒ³ï¼Œè¿™åˆ°åº•æ˜¯åŒäº²è¿˜æ˜¯å•äº²ã€‚ã€‚
â€¦â€¦â€¦ ä½ èµ¢äº†

ç¿»è¯‘çš„é—®é¢˜ parents ç¿»è¯‘æˆåŒäº²äº† åº”è¯¥å®é™…çš„æ„æ€æ˜¯å¤šå±‚çº§çˆ¶äº² (çˆ¶äº², çˆ¶äº²çš„çˆ¶äº²) è€Œä¸æ˜¯æŒ‡ çˆ¶äº²å’Œæ¯äº²
å›½å†…éƒ½ç¿»è¯‘æˆäº† åŒäº²åŠ è½½ æ‰€ä»¥å°±æˆäº†ä¸€ä¸ªæœ¯è¯­

ä¸æ˜¯å®Œå…¨æ‡‚ï¼Œè¯·æ•™ä¸‹ä½œè€…ï¼Œé©±åŠ¨åŠ è½½çš„ä¾‹å­ä¸­è¯´ç ´åäº†åŒäº²å§”æ´¾ç‰¹æ€§ï¼Œæ˜¯æ€ä¹ˆç ´åçš„å‘¢ï¼Ÿæœ€ç»ˆä¸è¿˜æ˜¯è·ŸæŒ‰ç…§åŒäº²å§”æ´¾å¤„ç†çš„å—ï¼Ÿä½¿ç”¨çš„çº¿ç¨‹ä¸Šä¸‹æ–‡åŠ è½½å™¨ä¸æ˜¯ applicationclassloader å—ï¼Ÿè°¢è°¢ï¼
å› ä¸ºåœ¨ driverManager ä¸­æ²¡æœ‰ä¼˜å…ˆä½¿ç”¨çˆ¶ç±»åŠ è½½å™¨åŠ è½½ï¼Œè€Œæ˜¯ç›´æ¥ç”¨ tccl åŠ è½½é©±åŠ¨ç±»ï¼Œè¿™å°±ä¸ç¬¦åˆåŒäº²å§”æ´¾äº†ã€‚åŒäº²å§”æ´¾ä¸€å®šæ˜¯å…ˆè®©çˆ¶ç±»åŠ è½½å™¨å°è¯•åŠ è½½çš„
ä¸»è¦æ˜¯æˆ‘æ²¡çœ‹æ‡‚é©±åŠ¨åŠ è½½æ—¶ ThreadContextClassloader ä»£è¡¨çš„æ˜¯å“ªä¸ªç±»åŠ è½½å™¨ï¼Œæ­£å¸¸åˆå§‹åŒ–æ˜¯è®¾ç½®çš„ AppClassloader å—ï¼Ÿé‚£é©±åŠ¨åŠ è½½æ—¶ä»£è¡¨çš„å“ªä¸ªå‘¢ï¼Ÿè°¢è°¢ï¼