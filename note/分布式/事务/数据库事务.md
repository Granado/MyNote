### 数据库事务

#### 一、事务的特性：

1 ）原子性 (Atomic) ：指整个数据库事务是不可分割的工作单位。

2 ）一致性 (Consistency) ：指数据库事务不能破坏关系数据的完整性以及业务逻辑的一致性。

3 ） 隔离性 (Isolation) ：指的是在并发环境中，当不同的事务同时操作相同的数据时，每个事务都有各自的完整数据空间。

4 ） 持久性 (Durability) ：指的是只要事务成功结束，它对数据库所做的更改就必须永久保存下来。

数据库采用日志来保证事务的原子性，一致性和持久性，日志记录了事务对数据库所做的更新，如果某个事务在执行过程中发生错误，就可以根据日志，撤销事务对数据库已做的更改，使数据库退回到执行事务前的初始状态。

数据库使用锁机制来保证事务的隔离性，拥有各自独立的空间。

数据库事务在高并发的时候引起的问题有：脏读、写覆盖、不可重复读和幻读等。

#### 二、脏读、幻读、不可重复读
#### 1.脏读：
脏读就是指当一个事务正在访问数据，并且对数据进行了修改，而这种修改还没有提交到数据库中，这时，另外一个事务也访问这个数据，然后使用了这个数据。

#### 2.不可重复读：
是指在一个事务内，多次读同一数据。在这个事务还没有结束时，另外一个事务也访问该同一数据。那么，在第一个事务中的两次读数据之间，由于第二个事务的修改，那么第一个事务两次读到的的数据可能是不一样的。这样就发生了在一个事务内两次读到的数据是不一样的，因此称为是不可重复读。（即不能读到相同的数据内容）
例如，一个编辑人员两次读取同一文档，但在两次读取之间，作者重写了该文档。当编辑人员第二次读取文档时，文档已更改。原始读取不可重复。如果只有在作者全部完成编写后编辑人员才可以读取文档，则可以避免该问题。

#### 3.幻读:
是指当事务不是独立执行时发生的一种现象，例如第一个事务对一个表中的数据进行了修改，这种修改涉及到表中的全部数据行。同时，第二个事务也修改这个表中的数据，这种修改是向表中插入一行新数据。那么，以后就会发生操作第一个事务的用户发现表中还有没有修改的数据行，就好象
发生了幻觉一样。
例如，一个编辑人员更改作者提交的文档，但当生产部门将其更改内容合并到该文档的主复本时，发现作者已将未编辑的新材料添加到该文档中。如果在编辑人员和生产部门完成对原始文档的处理之前，任何人都不能将新材料添加到文档中，则可以避免该问题。

| 隔离级别         | Dirty Read | Write Cover | NonRepeatable Read | Phantom Read |
| ---------------- | :--------: | :---------: | ------------------ | ------------ |
| Read uncommitted |    可能    |    可能     | 可能               | 可能         |
| Read committed   |   不可能   |    可能     | 可能               | 可能         |
| Repeatable read  |   不可能   |    可能     | 可能               | 可能         |
| Serializable     |   不可能   |   不可能    | 不可能             | 不可能       |
|                  |            |             |                    |              |
#### 参考 
[数据库并发访问、事务与锁的关系](http://blog.csdn.net/a616413086/article/details/51024327)
[数据库事务隔离级别-- 脏读、幻读、不可重复读（清晰解释）](http://blog.csdn.net/a616413086/article/details/51024327)